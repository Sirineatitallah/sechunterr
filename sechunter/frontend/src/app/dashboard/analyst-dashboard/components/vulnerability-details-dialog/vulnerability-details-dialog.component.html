<div class="vuln-details-dialog">
  <div class="dialog-header">
    <div class="header-content">
      <h2 class="dialog-title">{{ vulnerability.vulnerabilityName }}</h2>
      <div class="severity-badge" [ngClass]="getSeverityClass(vulnerability.severity)">
        {{ vulnerability.severity }}
      </div>
    </div>
    <button mat-icon-button (click)="onClose()">
      <mat-icon>close</mat-icon>
    </button>
  </div>

  <mat-divider></mat-divider>

  <div class="dialog-content">
    <div class="details-section">
      <div class="detail-item">
        <div class="detail-label">CVSS Score</div>
        <div class="detail-value cvss-score" [ngClass]="getSeverityClass(vulnerability.severity)">
          {{ vulnerability.cvssScore.toFixed(1) }}
        </div>
      </div>

      <div class="detail-item" *ngIf="vulnerability.epss">
        <div class="detail-label">EPSS Score</div>
        <div class="detail-value">{{ (vulnerability.epss * 100).toFixed(2) }}%</div>
      </div>

      <div class="detail-item">
        <div class="detail-label">Discovered</div>
        <div class="detail-value">{{ vulnerability.discoveredDate | date:'medium' }}</div>
      </div>

      <div class="detail-item">
        <div class="detail-label">Host</div>
        <div class="detail-value">{{ vulnerability.host_ip }}</div>
      </div>

      <div class="detail-item" *ngIf="vulnerability.host_name && vulnerability.host_name !== vulnerability.host_ip">
        <div class="detail-label">Host Name</div>
        <div class="detail-value">{{ vulnerability.host_name }}</div>
      </div>

      <div class="detail-item" *ngIf="vulnerability.port">
        <div class="detail-label">Port</div>
        <div class="detail-value">{{ vulnerability.port }}</div>
      </div>

      <div class="detail-item" *ngIf="vulnerability.protocol">
        <div class="detail-label">Protocol</div>
        <div class="detail-value">{{ vulnerability.protocol }}</div>
      </div>

      <div class="detail-item" *ngIf="vulnerability.service">
        <div class="detail-label">Service</div>
        <div class="detail-value">{{ vulnerability.service }}</div>
      </div>

      <div class="detail-item">
        <div class="detail-label">Remediation</div>
        <div class="detail-value">
          <span *ngIf="vulnerability.remediation" class="remediation-available">Available</span>
          <span *ngIf="!vulnerability.remediation" class="remediation-unavailable">Not Available</span>
        </div>
      </div>

      <div class="detail-item">
        <div class="detail-label">Status</div>
        <div class="detail-value">{{ vulnerability.status || 'Open' }}</div>
      </div>

      <div class="detail-item" *ngIf="vulnerability.plugin_id">
        <div class="detail-label">Plugin ID</div>
        <div class="detail-value">{{ vulnerability.plugin_id }}</div>
      </div>

      <div class="detail-item" *ngIf="vulnerability.plugin_family">
        <div class="detail-label">Plugin Family</div>
        <div class="detail-value">{{ vulnerability.plugin_family }}</div>
      </div>
    </div>

    <div class="cve-section">
      <h3>CVE IDs</h3>
      <div class="cve-list">
        <div *ngFor="let cve of vulnerability.cve_ids" class="cve-chip">
          <a [href]="'https://nvd.nist.gov/vuln/detail/' + cve" target="_blank">{{ cve }}</a>
        </div>
      </div>
    </div>

    <div class="description-section">
      <h3>Description</h3>
      <p>{{ vulnerability.description || 'No description available.' }}</p>
    </div>

    <div class="remediation-section" *ngIf="vulnerability.remediation">
      <h3>Remediation Steps</h3>
      <p>{{ vulnerability.remediation }}</p>
    </div>

    <div class="affected-systems-section" *ngIf="vulnerability.affectedSystems && vulnerability.affectedSystems.length > 0">
      <h3>Affected Systems</h3>
      <ul>
        <li *ngFor="let system of vulnerability.affectedSystems">{{ system }}</li>
      </ul>
    </div>

    <div class="affected-asset-section" *ngIf="vulnerability.affectedAsset">
      <h3>Affected Asset</h3>
      <p>{{ vulnerability.affectedAsset }}</p>
    </div>

    <div class="cpe-section" *ngIf="vulnerability.cpe_list">
      <h3>CPE</h3>
      <p>{{ vulnerability.cpe_list }}</p>
    </div>

    <div class="references-section" *ngIf="vulnerability.references && vulnerability.references.length > 0">
      <h3>References</h3>
      <ul>
        <li *ngFor="let ref of vulnerability.references">
          <a [href]="ref" target="_blank">{{ ref }}</a>
        </li>
      </ul>
    </div>
  </div>

  <mat-divider></mat-divider>

  <div class="dialog-actions">
    <button mat-button (click)="onClose()">Close</button>
    <button mat-button color="accent" *ngIf="vulnerability.cve_ids && vulnerability.cve_ids.length > 0"
            [matTooltip]="'View CVE details in NVD'"
            (click)="openCveDetails(vulnerability.cve_ids[0])">
      <mat-icon>open_in_new</mat-icon>
      View CVE Details
    </button>
    <button mat-raised-button color="primary" *ngIf="vulnerability.remediation">
      <mat-icon>build</mat-icon>
      Apply Remediation
    </button>
  </div>
</div>
